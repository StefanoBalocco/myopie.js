"use strict";class myopie{constructor(t,e,i={},s=[],o=1e3){this.timer=null,this.dataCurrent={},this.dataPrevious=null,this.hooks={init:{pre:[],post:[]},render:{pre:[],post:[]}},this.selector=t,this.template=e,this.timeout=o,this.inputToPath=s,this.dataCurrent=myopie.DeepClone(i),document.addEventListener("input",(t=>{const e=t,i=this.inputToPath.length;for(let t=0;t<i;t++)if(e&&e.target&&e.target.matches(this.inputToPath[t][0]))switch(e.target.type){case"checkbox":case"radio":this.set(this.inputToPath[t][1],e.target.checked,!1);break;default:this.set(this.inputToPath[t][1],e.target.value,!1)}}));let l=this.hooks.init.pre.length;for(let t=0;t<l;t++)this.hooks.init.post[t](this.dataCurrent,{});this.render(),l=this.hooks.init.post.length;for(let t=0;t<l;t++)this.hooks.init.post[t](this.dataCurrent,{})}static Create(t,e,i={},s=[],o=1e3){return new myopie(t,e,i,s,o)}static DeepClone(t){let e=null;for(var i in"function"==typeof t&&(e=t),e=Array.isArray(t)?[]:{},t){var s=t[i],o={}.toString.call(s).slice(8,-1);if("Array"==o||"Object"==o)e[i]=myopie.DeepClone(s);else if("Date"==o)e[i]=new Date(s.getTime());else if("RegExp"==o){let t="";if("string"==typeof s.source.flags)t=s.source.flags;else{let e=[];s.global&&e.push("g"),s.ignoreCase&&e.push("i"),s.multiline&&e.push("m"),s.sticky&&e.push("y"),s.unicode&&e.push("u"),t=e.join("")}e[i]=RegExp(s.source,t)}else e[i]=s}return e}static SameNode(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&t.src===e.src}DiffNode(t,e){const i=t.childNodes,s=e.childNodes;for(let t=0;t<i.length;t++){const o=i[t];if(void 0===s[t])e.appendChild(o);else{let e=!1;if(!myopie.SameNode(o,s[t])){let i=Array.from(s).slice(t+1).find((t=>myopie.SameNode(o,t)));i?s[t].before(i):(s[t].before(o),e=!0)}if(!e){const e=o.childNodes&&o.childNodes.length?null:o.textContent;if(e!=(s[t].childNodes&&s[t].childNodes.length?null:s[t].textContent)&&(s[t].textContent=e),1===o.nodeType){const e=o.attributes,i=s[t].attributes;for(let{name:o,value:l}of e)if(o.startsWith("dataCurrent-myopie-default-")&&12<o.length){const e=o.substr(12);null===i.getNamedItem(e)&&s[t].setAttribute(e,l)}else-1!==["input","option","textarea"].indexOf(s[t].tagName)&&-1!==["value","selected","checked"].indexOf(o)&&null!==i.getNamedItem(o)||s[t].setAttribute(o,l);for(let{name:o}of i)null===e.getNamedItem(o)&&s[t].removeAttribute(o)}if(!o.childNodes.length&&s[t].childNodes.length)s[t].innerHTML="";else if(!s[t].childNodes.length&&o.childNodes.length){let t=document.createDocumentFragment();this.DiffNode(o,t)}else this.DiffNode(o,s[t])}}}}HooksInitAddPre(t){this.hooks.init.pre.push(t)}HooksInitAddPost(t){this.hooks.init.post.push(t)}HooksRenderAddPre(t){this.hooks.render.pre.push(t)}HooksRenderAddPost(t){this.hooks.render.post.push(t)}render(){this.timer=null;const t=document.querySelector(this.selector);if(null!=t){let e=this.hooks.render.pre.length;for(let t=0;t<e;t++)this.hooks.render.pre[t](this.dataCurrent,this.dataPrevious);let i=(new DOMParser).parseFromString(this.template(this.dataCurrent),"text/html");i.head&&i.head.childNodes&&i.head.childNodes.length&&Array.from(i.head.childNodes).reverse().forEach((function(t){i.body.insertBefore(t,i.body.firstChild)}));const s=i&&i.body?i.body:document.createElement("body");this.DiffNode(s,t),e=this.hooks.render.post.length;for(let t=0;t<e;t++)this.hooks.render.post[t](this.dataCurrent,this.dataPrevious);this.dataPrevious=null}}get(t){let e=this.dataCurrent;if(null!=t){let i=t.split(/(?<!(?<!\\)\\)\//);const s=i.length;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}return e}set(t,e,i=!0){null===this.dataPrevious&&(this.dataPrevious=myopie.DeepClone(this.dataCurrent));let s=this.dataCurrent,o=t.split(/(?<!(?<!\\)\\)\//);const l=o.length;for(let t=0;t<l-1;t++){let e=o[t];void 0===s[e]&&(s[e]={}),s=s[e]}s[o[l-1]]=e,i&&(null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>this.render()),this.timeout))}}