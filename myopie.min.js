"use strict";export default class t{static t=document;static i=Object.prototype.toString;static o=Node.ELEMENT_NODE;static h=Node.TEXT_NODE;static l=/(?<!(?<!\\)\\)\//;static u={input:(t,e)=>{const s=t,i=e;return s.type===i.type&&s.name===i.name},img:(t,e)=>{const s=t,i=e;return!!s.src&&s.src===i.src},script:(t,e)=>{const s=t,i=e;return!!s.src&&s.src===i.src},a:(t,e)=>{const s=t,i=e;return!!s.href&&s.href===i.href},link:(t,e)=>{const s=t,i=e;return!!s.href&&s.href===i.href}};static p={input:t=>{const e=t;return["checkbox","radio"].includes(e.type)?e.checked:e.value},select:t=>t.value,textarea:t=>t.value};static m={Array:(t,e,s=!1)=>{const i=[!1,void 0],o=Number(e);return isNaN(o)||(s&&void 0===t[o]&&(t[o]={},i[0]=!0),i[1]=t[o]),i},Map:(t,e,s=!1)=>{const i=[!1,void 0];return s&&(t.has(e)||(i[0]=!0,t.set(e,{}))),i[1]=t.get(e),i},Object:(t,e,s=!1)=>{const i=[!1,void 0];return s&&void 0===t[e]&&(i[0]=!0,t[e]={}),i[1]=t[e],i},Set:(t,e,s=!1)=>{const i=[!1,void 0],o=Number(e);if(!isNaN(o)){const e=Array.from(t);void 0!==e[o]&&(i[1]=e[o])}return i}};v;_;A;k;P;T;S=new Map;N={};M;D=!1;R;j;I={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,s,i={},o=[],n=100,r=!0){this._=e,this.A=s,this.P=n,this.v=o,this.N=t.O(i),this.k=document.createElement("template"),this.T=e=>{const s=e?.target;if(s instanceof HTMLElement){const e=s.tagName.toLowerCase(),i=t.p[e];i&&this.v.some((([t,e])=>{let o=!1;return s.matches(t)&&(o=!0,this.set(e,i(s),r)),o}))}},t.t.addEventListener("input",this.T)}static O(e){let s=e;switch(t.i.call(e).slice(8,-1)){case"Array":case"Object":s=Array.isArray(e)?[]:{};for(const i in e){const o=e[i];s[i]=t.O(o)}break;case"Date":s=new Date(e.getTime());break;case"RegExp":s=RegExp(e.source,e.flags);break;case"Set":s=new Set;for(const i of e)s.add(t.O(i));break;case"Map":s=new Map;for(const[i,o]of e)s.set(i,t.O(o))}return s}static C(t,e){if(t.length&&e.length)for(const s of t)for(const{event:t,listener:i}of e)s.removeEventListener(t,i)}static L(t){return t.name.startsWith("data-")&&!t.name.startsWith("data-myopie-")}static F(t){return[t.name,t.value].join(String.fromCharCode(0))}static H(e,s){let i=e.nodeType===t.o&&e.nodeType===s.nodeType&&e.tagName===s.tagName&&e.id===s.id;if(!e.id&&i){const o=e.tagName.toLowerCase();if(o&&t.u[o])i=t.u[o](e,s);else{const o=Array.from(e.attributes).filter(t.L),n=Array.from(s.attributes).filter(t.L);if(o.length||n.length){i=o.map(t.F).sort().join(String.fromCharCode(0))===n.map(t.F).sort().join(String.fromCharCode(0))}else i=e.classList.length&&s.classList.length?Array.from(e.classList).sort().join(" ")===Array.from(s.classList).sort().join(" "):e.childElementCount===s.childElementCount}}return i}static q(e,s,i){const o=e.childNodes,n=s.childNodes,r=Array.from(n),a=o.length;for(let e=0;e<a;e++){const a=o[e];if(n.length<=e)switch(a.nodeType){case t.o:s.append(a.cloneNode(!0));break;case t.h:s.append(a.nodeValue)}else{let o=n[e];if(!o.isEqualNode(a)){const c=t.H(a,o),h=c?void 0:r.slice(e+1).find((e=>t.H(a,e)));if(c||(o=s.insertBefore(h??a.cloneNode(!0),e<n.length?o:null)),c||h){const e=a.childNodes.length?null:a.textContent;if(e!=(o.childNodes.length?null:o.textContent)&&(o.textContent=e),t.o===a.nodeType){const e=a.attributes,s=o.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(i.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(i.style=!0);let n=[];for(let{name:t,value:r}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===s.getNamedItem(e)&&(n.push(e),o.setAttribute(e,r))}else t.startsWith("data-myopie-")||(i?.style&&"style"==t||["input","option","textarea"].includes(o.tagName)&&["value","selected","checked"].includes(t))&&null!==s.getNamedItem(t)||o.setAttribute(t,r);for(let{name:t}of s)null!==e.getNamedItem(t)||n.includes(t)||i?.style&&"style"===t||o.removeAttribute(t);i.content||(!a.childNodes.length&&o.childNodes.length?o.innerHTML="":t.q(a,o,{...i}))}}}}}for(let t=n.length-1;t>=a;t--)n[t].remove()}renderDebounce(){this.P>0?(void 0!==this.j&&clearTimeout(this.j),this.j=setTimeout((()=>this.render()),this.P)):this.render()}destroy(){void 0!==this.j&&(clearTimeout(this.j),this.j=void 0),t.t.removeEventListener("input",this.T);for(const[e,s]of this.S){const i=t.t.querySelectorAll(e);t.C(i,s)}}hooksInitAddPre(t){this.I.init.pre.push(t)}hooksInitAddPost(t){this.I.init.post.push(t)}hooksRenderAddPre(t){this.I.render.pre.push(t)}hooksRenderAddPost(t){this.I.render.post.push(t)}handlersPermanentAdd(t,e,s){const i=this.S.get(t)??[];let o=!i.some((t=>e===t.event&&s===t.listener));return o&&this.S.set(t,[...i,{event:e,listener:s}]),o}handlersPermanentDel(e,s,i){let o=!1,n=this.S.get(e)??[];if(0<n.length){if(s){const t=n.filter((t=>!(t.event===s&&(!i||i===t.listener))));t.length<n.length&&(t.length?(n=n.filter((e=>!t.includes(e))),this.S.set(e,t)):this.S.delete(e),o=!0)}else this.S.delete(e),o=!0;const r=t.t.querySelectorAll(e);t.C(r,n)}return o}render(){let e=!0;clearTimeout(this.j),this.j=void 0;const s=t.t.querySelector(this._);if(null!=s){const e=this.A(this.N);if(e!==this.R){this.R=e,this.k.innerHTML=e;for(const[e,s]of this.S){const i=t.t.querySelectorAll(e);t.C(i,s)}this.D?this.I.render.pre.forEach((t=>t(this.N,this.M))):this.I.init.pre.forEach((t=>t(this.N))),t.q(this.k.content,s,{content:!1,style:!1}),s.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{e.name.startsWith("data-myopie-")&&t.removeAttribute(e.name)})))),this.D?this.I.render.post.forEach((t=>t(this.N,this.M))):(this.I.init.post.forEach((t=>t(this.N))),this.D=!0);for(const[e,s]of this.S){const i=t.t.querySelectorAll(e);if(i.length&&s.length)for(const t of i)for(const{event:e,listener:i}of s)t.addEventListener(e,i)}}this.M=void 0}else e=!1;return e}get(e){let s;if(null!=e){const i=e.split(t.l);0<i.length&&(s=i.reduce(((e,s)=>{if(void 0!==e){const i=t.i.call(e).slice(8,-1);e=(t.m[i]?t.m[i](e,s,!1):[!1,void 0])[1]}return e}),this.N))}return"function"==typeof s&&(s=s()),s}set(e,s,i=!0){let o=!1,n=!1;this.M||(n=!0,this.M=t.O(this.N));let r=!1;const a=e.split(t.l),c=a.length-1,h=a.slice(0,c).reduce(((e,s)=>{if(void 0!==e){const i=t.i.call(e).slice(8,-1);let o;[o,e]=t.m[i]?t.m[i](e,s,!0):[!1,void 0],r||=o}return e}),this.N);if(void 0!==h){o=!0;const t=a[c];h[t]!==s&&(r=!0,void 0!==s?h[t]=s:delete h[t]),r?i&&this.renderDebounce():n&&(this.M=void 0)}return o}}