"use strict";export default class t{static t=document;static i=Object.prototype.toString;static o=Node.ELEMENT_NODE;static h=Node.TEXT_NODE;static l=/(?<!(?<!\\)\\)\//;static u=/^data-myopie-(?:default|ignore)-/;static p=/^data-myopie-default-.+/;static m={input:(t,e)=>{const i=t,s=e;return!!i.type&&i.type===s.type&&!!i.name&&i.name===s.name&&!i.name.endsWith("[]")},img:(t,e)=>{const i=t,s=e;return!!i.src&&i.src===s.src},script:(t,e)=>{const i=t,s=e;return!!i.src&&i.src===s.src},a:(t,e)=>{const i=t,s=e;return!!i.href&&i.href===s.href},link:(t,e)=>{const i=t,s=e;return!!i.href&&i.href===s.href}};static _={input:t=>{const e=t;let i;switch(e.type){case"checkbox":case"radio":e.checked&&(i=e.value);break;default:i=e.value}return i},select:t=>t.value,textarea:t=>t.value};static v={Array:(t,e,i=!1)=>{const s=[!1,void 0],o=Number(e);return isNaN(o)||(i&&void 0===t[o]&&(t[o]={},s[0]=!0),s[1]=t[o]),s},Map:(t,e,i=!1)=>{const s=[!1,void 0];return i&&(t.has(e)||(s[0]=!0,t.set(e,{}))),s[1]=t.get(e),s},Object:(t,e,i=!1)=>{const s=[!1,void 0];return i&&void 0===t[e]&&(s[0]=!0,t[e]={}),s[1]=t[e],s},Set:(t,e,i=!1)=>{const s=[!1,void 0],o=Number(e);if(!isNaN(o)){const e=Array.from(t);void 0!==e[o]&&(s[1]=e[o])}return s}};A=[];k;P;T;S;M;N=new Map;D;R;j=!1;I;O;C={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,i,s={},o=[],n=100,r=!0){this.k=e,this.P=i,this.S=n,this.D=t.L(s),this.T=document.createElement("template"),Array.isArray(o)&&0<o.length&&(this.A=o,this.M=e=>{const i=e?.target;if(i instanceof HTMLElement){const e=i.tagName.toLowerCase();t._[e]&&this.A.some((([s,o])=>{let n=!1;return i.matches(s)&&(n=!0,this.set(o,t._[e](i),r)),n}))}},t.t.addEventListener("input",this.M))}static L(e){let i=e;switch(t.i.call(e).slice(8,-1)){case"Array":case"Object":i=Array.isArray(e)?[]:{};for(const s in e){const o=e[s];i[s]=t.L(o)}break;case"Date":i=new Date(e.getTime());break;case"RegExp":i=RegExp(e.source,e.flags);break;case"Set":i=new Set;for(const s of e)i.add(t.L(s));break;case"Map":i=new Map;for(const[s,o]of e)i.set(s,t.L(o))}return i}static F(t,e){if(t.length&&e.length)for(const i of t)for(const{event:t,listener:s}of e)i.removeEventListener(t,s)}static H(t){return t.name.startsWith("data-")&&!t.name.startsWith("data-myopie-")}static q(t){return[t.name,t.value].join(String.fromCharCode(0))}static B(e,i){let s=0;if(e.isEqualNode(i))s|=1<<30;else if(t.o===e.nodeType&&e.nodeType===i.nodeType&&e.tagName===i.tagName&&e.id===i.id&&e.getAttribute("data-myopie-id")===i.getAttribute("data-myopie-id")){e.getAttribute("data-myopie-id")&&(s|=1<<28),e.id&&(s|=1<<27),e.innerHTML===i.innerHTML&&(s|=1<<26);const o=e.tagName.toLowerCase();o&&t.m[o]&&t.m[o](e,i)&&(s|=1<<25);const n=Array.from(e.attributes).filter(t.H),r=Array.from(i.attributes).filter(t.H);if(n.length===r.length){n.map(t.q).sort().join(String.fromCharCode(0))===r.map(t.q).sort().join(String.fromCharCode(0))&&(s|=1<<24)}if(e.classList.length&&i.classList.length){Array.from(e.classList).sort().join(" ")===Array.from(i.classList).sort().join(" ")&&(s|=1<<23)}e.childElementCount===i.childElementCount&&(s|=1<<22)}return s}static G(e,i,s){const o=e.childNodes,n=i.childNodes,r=Array.from(n),a=o.length;for(let e=0;e<a;e++){const a=o[e];if([t.o,t.h].includes(o[e].nodeType))if(r.length){let o,c=0;r.find((e=>{const i=t.B(a,e);return i>c&&(c=i,o=e),c>=1<<25})),o?r.splice(r.indexOf(o),1):o=a.cloneNode(!0);let h=n[e];if(h.isEqualNode(o)||(h=i.insertBefore(o,n[e])),!h.isEqualNode(a)){const e=a.childNodes.length?null:a.textContent,i=h.childNodes.length?null:h.textContent;if(t.o===a.nodeType){const o=[];"true"===a.getAttribute("data-myopie-ignore-content")&&(s.content=!0),"true"===a.getAttribute("data-myopie-ignore-style")&&(s.style=!0),s.content||e!=i&&(h.textContent=e);for(let{name:e,value:i}of a.attributes)if(t.p.test(e)){const t=e.substring(20);null===h.getAttribute(t)&&(o.push(t),h.setAttribute(t,i))}else if(!t.u.test(e)){const t=s?.style&&"style"===e,o=["input","option","textarea"].includes(h.tagName.toLowerCase())&&["value","selected","checked"].includes(e),n=h.getAttribute(e);(n===i||t||o)&&null!==n||h.setAttribute(e,i)}for(let{name:t}of h.attributes)null!==a.getAttribute(t)||o.includes(t)||s?.style&&"style"===t||h.removeAttribute(t);!s.content&&a.childNodes.length&&t.G(a,h,{...s})}}}else switch(a.nodeType){case t.h:case t.o:i.append(a.cloneNode(!0))}}for(let t=n.length-1;t>=a;t--)n[t].remove()}renderDebounce(){this.S>0?(void 0!==this.O&&clearTimeout(this.O),this.O=setTimeout((()=>this.render()),this.S)):this.render()}destroy(){void 0!==this.O&&(clearTimeout(this.O),this.O=void 0),this.M&&t.t.removeEventListener("input",this.M);for(const[e,i]of this.N){const s=t.t.querySelectorAll(e);t.F(s,i)}}hooksInitAddPre(t){this.C.init.pre.push(t)}hooksInitAddPost(t){this.C.init.post.push(t)}hooksRenderAddPre(t){this.C.render.pre.push(t)}hooksRenderAddPost(t){this.C.render.post.push(t)}handlersPermanentAdd(t,e,i){const s=this.N.get(t)??[];let o=!s.some((t=>e===t.event&&i===t.listener));return o&&this.N.set(t,[...s,{event:e,listener:i}]),o}handlersPermanentDel(e,i,s){let o=!1,n=this.N.get(e)??[];if(0<n.length){if(i){const t=n.filter((t=>!(t.event===i&&(!s||s===t.listener))));t.length<n.length&&(t.length?(n=n.filter((e=>!t.includes(e))),this.N.set(e,t)):this.N.delete(e),o=!0)}else this.N.delete(e),o=!0;const r=t.t.querySelectorAll(e);t.F(r,n)}return o}render(){let e=!0;clearTimeout(this.O),this.O=void 0;const i=t.t.querySelector(this.k);if(null!=i){const e=this.P(this.D);if(e!==this.I){this.I=e,this.T.innerHTML=e;for(const[e,i]of this.N){const s=t.t.querySelectorAll(e);t.F(s,i)}this.j?this.C.render.pre.forEach((t=>t(this.D,this.R))):this.C.init.pre.forEach((t=>t(this.D))),t.G(this.T.content,i,{content:!1,style:!1}),i.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{(e.name.startsWith("data-myopie-default-")||e.name.startsWith("data-myopie-ignore-"))&&t.removeAttribute(e.name)})))),this.j?this.C.render.post.forEach((t=>t(this.D,this.R))):(this.C.init.post.forEach((t=>t(this.D))),this.j=!0);for(const[e,i]of this.N){const s=t.t.querySelectorAll(e);if(s.length&&i.length)for(const t of s)for(const{event:e,listener:s}of i)t.addEventListener(e,s)}}this.R=void 0}else e=!1;return e}get(e){let i;if(null!=e){const s=e.split(t.l);0<s.length&&(i=s.reduce(((e,i)=>{if(void 0!==e){const s=t.i.call(e).slice(8,-1);e=(t.v[s]?t.v[s](e,i,!1):[!1,void 0])[1]}return e}),this.D))}return"function"==typeof i&&(i=i()),i}set(e,i,s=!0){let o=!1,n=!1;this.R||(n=!0,this.R=t.L(this.D));let r=!1;const a=e.split(t.l),c=a.length-1,h=a.slice(0,c).reduce(((e,i)=>{if(void 0!==e){const s=t.i.call(e).slice(8,-1);let o;[o,e]=t.v[s]?t.v[s](e,i,!0):[!1,void 0],r||=o}return e}),this.D);if(void 0!==h){o=!0;const t=a[c];h[t]!==i&&(r=!0,void 0!==i?h[t]=i:delete h[t]),r?s&&this.renderDebounce():n&&(this.R=void 0)}return o}}