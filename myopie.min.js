"use strict";export default class t{static t=document;static i=Object.prototype.toString;static o=Node.ELEMENT_NODE;static h=Node.TEXT_NODE;static l=Node.COMMENT_NODE;static u=/(?<!(?<!\\)\\)\//;static p={input:(t,e)=>{const i=t,s=e;return i.type===s.type&&i.name===s.name},img:(t,e)=>{const i=t,s=e;return!!i.src&&i.src===s.src},script:(t,e)=>{const i=t,s=e;return!!i.src&&i.src===s.src},a:(t,e)=>{const i=t,s=e;return!!i.href&&i.href===s.href},link:(t,e)=>{const i=t,s=e;return!!i.href&&i.href===s.href}};static m={input:t=>{const e=t;let i;switch(e.type){case"checkbox":case"radio":e.checked&&(i=e.value);break;default:i=e.value}return i},select:t=>t.value,textarea:t=>t.value};static v={Array:(t,e,i=!1)=>{const s=[!1,void 0],o=Number(e);return isNaN(o)||(i&&void 0===t[o]&&(t[o]={},s[0]=!0),s[1]=t[o]),s},Map:(t,e,i=!1)=>{const s=[!1,void 0];return i&&(t.has(e)||(s[0]=!0,t.set(e,{}))),s[1]=t.get(e),s},Object:(t,e,i=!1)=>{const s=[!1,void 0];return i&&void 0===t[e]&&(s[0]=!0,t[e]={}),s[1]=t[e],s},Set:(t,e,i=!1)=>{const s=[!1,void 0],o=Number(e);if(!isNaN(o)){const e=Array.from(t);void 0!==e[o]&&(s[1]=e[o])}return s}};_=[];A;k;T;P;N;S=new Map;M;D;R=!1;j;C;I={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,i,s={},o=[],n=100,r=!0){this.A=e,this.k=i,this.P=n,this.M=t.O(s),this.T=document.createElement("template"),Array.isArray(o)&&0<o.length&&(this._=o,this.N=e=>{const i=e?.target;if(i instanceof HTMLElement){const e=i.tagName.toLowerCase();t.m[e]&&this._.some((([s,o])=>{let n=!1;return i.matches(s)&&(n=!0,this.set(o,t.m[e](i),r)),n}))}},t.t.addEventListener("input",this.N))}static O(e){let i=e;switch(t.i.call(e).slice(8,-1)){case"Array":case"Object":i=Array.isArray(e)?[]:{};for(const s in e){const o=e[s];i[s]=t.O(o)}break;case"Date":i=new Date(e.getTime());break;case"RegExp":i=RegExp(e.source,e.flags);break;case"Set":i=new Set;for(const s of e)i.add(t.O(s));break;case"Map":i=new Map;for(const[s,o]of e)i.set(s,t.O(o))}return i}static L(t,e){if(t.length&&e.length)for(const i of t)for(const{event:t,listener:s}of e)i.removeEventListener(t,s)}static F(t){return t.name.startsWith("data-")&&!t.name.startsWith("data-myopie-")}static H(t){return[t.name,t.value].join(String.fromCharCode(0))}static q(e,i){let s=0;if(e.isEqualNode(i))s|=1<<30;else if(e.nodeType===i.nodeType)switch(e.nodeType){case t.h:case t.l:e.nodeValue===i.nodeValue&&(s|=1<<29);break;case t.o:if(e.tagName===i.tagName&&e.id===i.id){e.attributes.getNamedItem("data-myopie-id")&&e.attributes.getNamedItem("data-myopie-id").value===i.attributes.getNamedItem("data-myopie-id")?.value&&(s|=1<<28),e.id&&(s|=1<<27),e.innerHTML===i.innerHTML&&(s|=1<<26);const o=e.tagName.toLowerCase();o&&t.p[o]&&t.p[o](e,i)&&(s|=1<<25);const n=Array.from(e.attributes).filter(t.F),r=Array.from(i.attributes).filter(t.F);if(n.length===r.length){n.map(t.H).sort().join(String.fromCharCode(0))===r.map(t.H).sort().join(String.fromCharCode(0))&&(s|=1<<24)}if(e.classList.length&&i.classList.length){Array.from(e.classList).sort().join(" ")===Array.from(i.classList).sort().join(" ")&&(s|=1<<23)}e.childElementCount===i.childElementCount&&(s|=1<<22)}}return s}static B(e,i,s){const o=e.childNodes,n=i.childNodes,r=Array.from(n),a=o.length;for(let e=0;e<a;e++){const a=o[e];if([t.o,t.h].includes(o[e].nodeType))if(n.length<=e)switch(a.nodeType){case t.o:i.append(a.cloneNode(!0));break;case t.h:i.append(a.nodeValue)}else{let o,c=0;r.slice(e).find((e=>{const i=t.q(a,e);return i>c&&(c=i,o=e),c>=1<<25})),o||(o=a.cloneNode(!0));let h=n[e];if(h.isEqualNode(o)||(h=i.insertBefore(o,e<n.length?n[e]:null)),!h.isEqualNode(a)){const e=a.childNodes.length?null:a.textContent;if(e!=(h.childNodes.length?null:h.textContent)&&(h.textContent=e),t.o===a.nodeType){const e=a.attributes,i=h.attributes,o=[];"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(s.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(s.style=!0);for(let{name:t,value:n}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===i.getNamedItem(e)&&(o.push(e),h.setAttribute(e,n))}else if(!t.startsWith("data-myopie-default-")&&!t.startsWith("data-myopie-ignore-")){const e=s?.style&&"style"===t,o=["input","option","textarea"].includes(h.tagName)&&["value","selected","checked"].includes(t),r=i.getNamedItem(t);(r?.value===n||e||o)&&null!==r||h.setAttribute(t,n)}for(let{name:t}of i)null!==e.getNamedItem(t)||o.includes(t)||s?.style&&"style"===t||h.removeAttribute(t);s.content||(!a.childNodes.length&&h.childNodes.length?h.innerHTML="":t.B(a,h,{...s}))}}}}for(let t=n.length-1;t>=a;t--)n[t].remove()}renderDebounce(){this.P>0?(void 0!==this.C&&clearTimeout(this.C),this.C=setTimeout((()=>this.render()),this.P)):this.render()}destroy(){void 0!==this.C&&(clearTimeout(this.C),this.C=void 0),this.N&&t.t.removeEventListener("input",this.N);for(const[e,i]of this.S){const s=t.t.querySelectorAll(e);t.L(s,i)}}hooksInitAddPre(t){this.I.init.pre.push(t)}hooksInitAddPost(t){this.I.init.post.push(t)}hooksRenderAddPre(t){this.I.render.pre.push(t)}hooksRenderAddPost(t){this.I.render.post.push(t)}handlersPermanentAdd(t,e,i){const s=this.S.get(t)??[];let o=!s.some((t=>e===t.event&&i===t.listener));return o&&this.S.set(t,[...s,{event:e,listener:i}]),o}handlersPermanentDel(e,i,s){let o=!1,n=this.S.get(e)??[];if(0<n.length){if(i){const t=n.filter((t=>!(t.event===i&&(!s||s===t.listener))));t.length<n.length&&(t.length?(n=n.filter((e=>!t.includes(e))),this.S.set(e,t)):this.S.delete(e),o=!0)}else this.S.delete(e),o=!0;const r=t.t.querySelectorAll(e);t.L(r,n)}return o}render(){let e=!0;clearTimeout(this.C),this.C=void 0;const i=t.t.querySelector(this.A);if(null!=i){const e=this.k(this.M);if(e!==this.j){this.j=e,this.T.innerHTML=e;for(const[e,i]of this.S){const s=t.t.querySelectorAll(e);t.L(s,i)}this.R?this.I.render.pre.forEach((t=>t(this.M,this.D))):this.I.init.pre.forEach((t=>t(this.M))),t.B(this.T.content,i,{content:!1,style:!1}),i.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{(e.name.startsWith("data-myopie-default-")||e.name.startsWith("data-myopie-ignore-"))&&t.removeAttribute(e.name)})))),this.R?this.I.render.post.forEach((t=>t(this.M,this.D))):(this.I.init.post.forEach((t=>t(this.M))),this.R=!0);for(const[e,i]of this.S){const s=t.t.querySelectorAll(e);if(s.length&&i.length)for(const t of s)for(const{event:e,listener:s}of i)t.addEventListener(e,s)}}this.D=void 0}else e=!1;return e}get(e){let i;if(null!=e){const s=e.split(t.u);0<s.length&&(i=s.reduce(((e,i)=>{if(void 0!==e){const s=t.i.call(e).slice(8,-1);e=(t.v[s]?t.v[s](e,i,!1):[!1,void 0])[1]}return e}),this.M))}return"function"==typeof i&&(i=i()),i}set(e,i,s=!0){let o=!1,n=!1;this.D||(n=!0,this.D=t.O(this.M));let r=!1;const a=e.split(t.u),c=a.length-1,h=a.slice(0,c).reduce(((e,i)=>{if(void 0!==e){const s=t.i.call(e).slice(8,-1);let o;[o,e]=t.v[s]?t.v[s](e,i,!0):[!1,void 0],r||=o}return e}),this.M);if(void 0!==h){o=!0;const t=a[c];h[t]!==i&&(r=!0,void 0!==i?h[t]=i:delete h[t]),r?s&&this.renderDebounce():n&&(this.D=void 0)}return o}}