"use strict";class myopie{constructor(t,e,i={},s=[],o,l){this.timeout={render:0,resize:0},this.timer={render:void 0,resize:void 0},this.dataCurrent={},this.dataPrevious=null,this.inited=!1,this.hooks={init:{pre:[],post:[]},render:{pre:[],post:[]},resize:{pre:[],post:[]}},this.selector=t,this.template=e,this.timeout.render=o,this.timeout.resize=l,this.inputToPath=s,this.dataCurrent=myopie.DeepClone(i),document.addEventListener("input",(t=>{const e=t,i=this.inputToPath.length;for(let t=0;t<i;t++)if(e&&e.target&&e.target.matches(this.inputToPath[t][0]))switch(e.target.type){case"checkbox":case"radio":this.set(this.inputToPath[t][1],e.target.checked,!1);break;default:this.set(this.inputToPath[t][1],e.target.value,!1)}}))}static Create(t,e,i={},s=[],o=1e3,l){return new myopie(t,e,i,s,o,l)}static DeepClone(t){let e=null;switch(typeof t){case"undefined":case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":e=t;break;case"object":if(null===t)e=null;else{e=Array.isArray(t)?[]:{};for(let i in t){let s=t[i],o={}.toString.call(s).slice(8,-1);if("Array"==o||"Object"==o)e[i]=myopie.DeepClone(s);else if("Date"==o)e[i]=new Date(s.getTime());else if("RegExp"==o){let t="";if("string"==typeof s.source.flags)t=s.source.flags;else{let e=[];s.global&&e.push("g"),s.ignoreCase&&e.push("i"),s.multiline&&e.push("m"),s.sticky&&e.push("y"),s.unicode&&e.push("u"),t=e.join("")}e[i]=RegExp(s.source,t)}else e[i]=s}}}return e}static SimilarNode(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}DiffNode(t,e){var i,s,o,l,n;const r=t.childNodes,h=e.childNodes,a={enabled:"true"===(null===(s=null===(i=t.attributes)||void 0===i?void 0:i.getNamedItem("data-myopie-masonry"))||void 0===s?void 0:s.value),changes:!1,widthContainer:0,positionLeft:0,columns:0,widthColumn:0,widthGutter:0,heightGutter:0,heightColumns:[]};if(a.enabled&&r.length){const t=getComputedStyle(e);a.widthContainer=e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight);const i=document.createElement("div");i.style.visibility="hidden",i.className="myopie-masonry-column",e.appendChild(i),a.widthColumn=i.offsetWidth,e.removeChild(i),i.className="myopie-masonry-gutter",e.appendChild(i),a.widthGutter=i.offsetWidth,a.heightGutter=i.offsetHeight,e.removeChild(i),a.columns=1+Math.floor((a.widthContainer-a.widthColumn)/(a.widthColumn+a.widthGutter)),a.positionLeft=(a.widthContainer-((a.columns-1)*(a.widthColumn+a.widthGutter)+a.widthColumn))/2,e.style.position="relative";for(let t=0;t<a.columns;t++)a.heightColumns[t]=0}for(let t=0;t<r.length;t++){const i=r[t];let s;if(t>=h.length&&(1!==i.nodeType||"true"!==(null===(l=null===(o=i.attributes)||void 0===o?void 0:o.getNamedItem("data-myopie-masonry"))||void 0===l?void 0:l.value)&&null===i.querySelector('[data-myopie-masonry="true"]')))s=e.appendChild(i.cloneNode(!0));else{s=null!==(n=h[t])&&void 0!==n?n:e.appendChild(i.cloneNode());let o=!1;if(!s.isEqualNode(i)){if(!myopie.SimilarNode(i,s)){let l=Array.from(h).slice(t+1).find((t=>myopie.SimilarNode(i,t)));l?s=e.insertBefore(l.cloneNode(!0),t<h.length?s:null):(s=e.insertBefore(i.cloneNode(!0),t<h.length?s:null),o=!0)}if(!o){const t=i.childNodes&&i.childNodes.length?null:i.textContent;if(t!=(s.childNodes&&s.childNodes.length?null:s.textContent)&&(s.textContent=t),1===i.nodeType){const t=i.attributes,e=s.attributes;for(let{name:i,value:o}of t)if(i.startsWith("data-myopie-default-")&&20<i.length){const t=i.substr(20);null===e.getNamedItem(t)&&s.setAttribute(t,o)}else-1!==["input","option","textarea"].indexOf(s.tagName)&&-1!==["value","selected","checked"].indexOf(i)&&null!==e.getNamedItem(i)||s.setAttribute(i,o);for(let{name:i}of e)null===t.getNamedItem(i)&&(a.enabled&&"style"===i||s.removeAttribute(i))}!i.childNodes.length&&s.childNodes.length?s.innerHTML="":(!s.childNodes.length&&i.childNodes.length,this.DiffNode(i,s));for(let t=h.length-r.length;t>0;t--)h[h.length-1].remove()}}}if(a.enabled&&1===s.nodeType){let e=0;if(t<a.columns)e=t;else{let t=a.heightColumns[0];for(let i=1;i<a.columns;i++)a.heightColumns[i]<t&&(t=a.heightColumns[i],e=i)}if(0<a.heightColumns[e]&&(a.heightColumns[e]+=a.heightGutter),a.changes||!s.style.position){s.style.transition="",s.style.width="0",s.style.transition="width 0.5s",a.changes=!0;let t=a.positionLeft;s.style.position="absolute",s.style.width=a.widthColumn+"px",t+=e*(a.widthColumn+a.widthGutter),s.style.left=t+(0<t?"px":"");let i=a.heightColumns[e];s.style.top=i+(0<i?"px":"")}a.heightColumns[e]+=s.offsetHeight}}if(a.enabled){let t=a.heightColumns[0];for(let e=1;e<a.columns;e++)a.heightColumns[e]>t&&(t=a.heightColumns[e]);e.style.height=t+"px"}}HooksInitAddPre(t){this.hooks.init.pre.push(t)}HooksInitAddPost(t){this.hooks.init.post.push(t)}HooksRenderAddPre(t){this.hooks.render.pre.push(t)}HooksRenderAddPost(t){this.hooks.render.post.push(t)}resize(){this.timer.resize=void 0;if(null!=document.querySelector(this.selector)){let t=document.querySelectorAll(this.selector+' [data-myopie-masonry="true"]').length;for(let e=0;e<t;e++){let t=this.hooks.resize.pre.length;for(let e=0;e<t;e++)this.hooks.resize.pre[e](this.dataCurrent);t=this.hooks.resize.post.length;for(let e=0;e<t;e++)this.hooks.resize.post[e](this.dataCurrent)}}}render(){this.timer.render=void 0;const t=document.querySelector(this.selector);if(null!=t){if(this.inited){const t=this.hooks.render.pre.length;for(let e=0;e<t;e++)this.hooks.render.pre[e](this.dataCurrent,this.dataPrevious)}else{const t=this.hooks.init.pre.length;for(let e=0;e<t;e++)this.hooks.init.pre[e](this.dataCurrent)}let e=(new DOMParser).parseFromString(this.template(this.dataCurrent),"text/html");e.head&&e.head.childNodes&&e.head.childNodes.length&&Array.from(e.head.childNodes).reverse().forEach((function(t){e.body.insertBefore(t,e.body.firstChild)}));const i=e&&e.body?e.body:document.createElement("body");if(this.DiffNode(i,t),this.inited){const t=this.hooks.render.post.length;for(let e=0;e<t;e++)this.hooks.render.post[e](this.dataCurrent,this.dataPrevious)}else{const t=this.hooks.init.post.length;for(let e=0;e<t;e++)this.hooks.init.post[e](this.dataCurrent);this.inited=!0}this.dataPrevious=null}}get(t){let e=this.dataCurrent;if(null!=t){let i=t.split(/(?<!(?<!\\)\\)\//);const s=i.length;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}return e}set(t,e,i=!0){null===this.dataPrevious&&(this.dataPrevious=myopie.DeepClone(this.dataCurrent));let s=this.dataCurrent,o=t.split(/(?<!(?<!\\)\\)\//);const l=o.length;for(let t=0;t<l-1;t++){let e=o[t];void 0===s[e]&&(s[e]={}),s=s[e]}s[o[l-1]]=e,i&&(this.timeout.render>0?(void 0!==this.timer.render&&clearTimeout(this.timer.render),this.timer.render=setTimeout((()=>this.render()),this.timeout.render)):this.render())}}