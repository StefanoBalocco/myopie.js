"use strict";class myopie{constructor(t,e,i=[],s=1e3){this.timer=null,this.dataCurrent={},this.dataPrevious=null,this.hooks={pre:[],post:[]},this.selector=t,this.template=e,this.timeout=s,this.inputToPath=i,document.addEventListener("input",(t=>{const e=t,i=this.inputToPath.length;for(let t=0;t<i;t++)if(e&&e.target&&e.target.matches(this.inputToPath[t][0]))switch(e.target.type){case"checkbox":case"radio":this.set(this.inputToPath[t][1],e.target.checked,!1);break;default:this.set(this.inputToPath[t][1],e.target.value,!1)}}))}static Create(t,e,i=[],s=1e3){return new myopie(t,e,i,s)}static SameNode(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&t.src===e.src}DiffNode(t,e){const i=t.childNodes,s=e.childNodes;for(let t=0;t<i.length;t++){const l=i[t];if(void 0===s[t])e.appendChild(l);else{let e=!1;if(!myopie.SameNode(l,s[t])){let i=Array.from(s).slice(t+1).find((t=>myopie.SameNode(l,t)));i?s[t].before(i):(s[t].before(l),e=!0)}if(!e){const e=l.childNodes&&l.childNodes.length?null:l.textContent;if(e!=(s[t].childNodes&&s[t].childNodes.length?null:s[t].textContent)&&(s[t].textContent=e),1===l.nodeType){const e=l.attributes,i=s[t].attributes;for(let{name:l,value:o}of e)if(l.startsWith("dataCurrent-myopie-default-")&&12<l.length){const e=l.substr(12);null===i.getNamedItem(e)&&s[t].setAttribute(e,o)}else-1!==["input","option","textarea"].indexOf(s[t].tagName)&&-1!==["value","selected","checked"].indexOf(l)&&null!==i.getNamedItem(l)||s[t].setAttribute(l,o);for(let{name:l}of i)null===e.getNamedItem(l)&&s[t].removeAttribute(l)}if(!l.childNodes.length&&s[t].childNodes.length)s[t].innerHTML="";else if(!s[t].childNodes.length&&l.childNodes.length){let t=document.createDocumentFragment();this.DiffNode(l,t)}else this.DiffNode(l,s[t])}}}}HookAddPre(t){this.hooks.pre.push(t)}HookAddPost(t){this.hooks.post.push(t)}render(){this.timer=null;const t=document.querySelector(this.selector);if(null!=t){let e=this.hooks.pre.length;for(let t=0;t<e;t++)this.hooks.pre[t](this.dataCurrent,this.dataPrevious);let i=(new DOMParser).parseFromString(this.template(this.dataCurrent),"text/html");i.head&&i.head.childNodes&&i.head.childNodes.length&&Array.from(i.head.childNodes).reverse().forEach((function(t){i.body.insertBefore(t,i.body.firstChild)}));const s=i&&i.body?i.body:document.createElement("body");this.DiffNode(s,t),e=this.hooks.post.length;for(let t=0;t<e;t++)this.hooks.post[t](this.dataCurrent,this.dataPrevious);this.dataPrevious=null}}get(t){let e=this.dataCurrent;if(null!=t){let i=t.split(/(?<!(?<!\\)\\)\//);const s=i.length;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}return e}set(t,e,i=!0){null===this.dataPrevious&&(this.dataPrevious=Object.assign({},this.dataCurrent));let s=this.dataCurrent,l=t.split(/(?<!(?<!\\)\\)\//);const o=l.length;for(let t=0;t<o-1;t++){let e=l[t];void 0===s[e]&&(s[e]={}),s=s[e]}s[l[o-1]]=e,i&&(null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>this.render()),this.timeout))}}