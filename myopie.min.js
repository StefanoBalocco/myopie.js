"use strict";export default class t{static t=document;static i=Object.prototype.toString;static o=Node.ELEMENT_NODE;static h=Node.TEXT_NODE;static l=/(?<!(?<!\\)\\)\//;static u={input:t=>{const e=t;return["checkbox","radio"].includes(e.type)?e.checked:e.value},select:t=>t.value,textarea:t=>t.value};static p={Array:(t,e,s=!1)=>{const i=[!1,void 0],o=Number(e);return isNaN(o)||(s&&void 0===t[o]&&(t[o]={},i[0]=!0),i[1]=t[o]),i},Map:(t,e,s=!1)=>{const i=[!1,void 0];return s&&(t.has(e)||(i[0]=!0,t.set(e,{}))),i[1]=t.get(e),i},Object:(t,e,s=!1)=>{const i=[!1,void 0];return s&&void 0===t[e]&&(i[0]=!0,t[e]={}),i[1]=t[e],i},Set:(t,e,s=!1)=>{const i=[!1,void 0],o=Number(e);if(!isNaN(o)){const e=Array.from(t);void 0!==e[o]&&(i[1]=e[o])}return i}};m;v;_;k;A;P;T=new Map;N={};S;D=!1;M;R;j={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,s,i={},o=[],n=100,r=!0){this.v=e,this._=s,this.A=n,this.m=o,this.N=t.I(i),this.k=document.createElement("template"),this.P=e=>{const s=e?.target;if(s instanceof HTMLElement){const e=s.tagName.toLowerCase(),i=t.u[e];i&&this.m.some((([t,e])=>{let o=!1;return s.matches(t)&&(o=!0,this.set(e,i(s),r)),o}))}},t.t.addEventListener("input",this.P)}static I(e){let s=e;switch(t.i.call(e).slice(8,-1)){case"Array":case"Object":s=Array.isArray(e)?[]:{};for(const i in e){const o=e[i];s[i]=t.I(o)}break;case"Date":s=new Date(e.getTime());break;case"RegExp":s=RegExp(e.source,e.flags);break;case"Set":s=new Set;for(const i of e)s.add(t.I(i));break;case"Map":s=new Map;for(const[i,o]of e)s.set(i,t.I(o))}return s}static O(t,e){if(t.length&&e.length)for(const s of t)for(const{event:t,listener:i}of e)s.removeEventListener(t,i)}static C(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(!!t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}static L(e,s,i){const o=e.childNodes,n=s.childNodes,r=o.length;for(let e=0;e<r;e++){const r=o[e];if(n.length<=e)switch(r.nodeType){case t.o:s.append(r.cloneNode(!0));break;case t.h:s.append(r.nodeValue)}else{let o=n[e];if(!o.isEqualNode(r)){const c=t.C(r,o),a=c?void 0:Array.from(n).slice(e+1).find((e=>t.o===e.nodeType&&t.C(r,e)));if(c||(o=s.insertBefore(a??r.cloneNode(!0),e<n.length?o:null)),c||a){const e=r.childNodes.length?null:r.textContent;if(e!=(o.childNodes.length?null:o.textContent)&&(o.textContent=e),t.o===r.nodeType){const e=r.attributes,s=o.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(i.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(i.style=!0);let n=[];for(let{name:t,value:r}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===s.getNamedItem(e)&&(n.push(e),o.setAttribute(e,r))}else t.startsWith("data-myopie-")||(i?.style&&"style"==t||["input","option","textarea"].includes(o.tagName)&&["value","selected","checked"].includes(t))&&null!==s.getNamedItem(t)||o.setAttribute(t,r);for(let{name:t}of s)null!==e.getNamedItem(t)||n.includes(t)||i?.style&&"style"===t||o.removeAttribute(t);i.content||(!r.childNodes.length&&o.childNodes.length?o.innerHTML="":t.L(r,o,{...i}))}}}}}for(let t=n.length-1;t>=r;t--)n[t].remove()}renderDebounce(){this.A>0?(void 0!==this.R&&clearTimeout(this.R),this.R=setTimeout((()=>this.render()),this.A)):this.render()}destroy(){void 0!==this.R&&(clearTimeout(this.R),this.R=void 0),t.t.removeEventListener("input",this.P);for(const[e,s]of this.T){const i=t.t.querySelectorAll(e);t.O(i,s)}}hooksInitAddPre(t){this.j.init.pre.push(t)}hooksInitAddPost(t){this.j.init.post.push(t)}hooksRenderAddPre(t){this.j.render.pre.push(t)}hooksRenderAddPost(t){this.j.render.post.push(t)}handlersPermanentAdd(t,e,s){const i=this.T.get(t)??[];let o=!i.some((t=>e===t.event&&s===t.listener));return o&&this.T.set(t,[...i,{event:e,listener:s}]),o}handlersPermanentDel(e,s,i){let o=!1,n=this.T.get(e)??[];if(0<n.length){if(s){const t=n.filter((t=>!(t.event===s&&(!i||i===t.listener))));t.length<n.length&&(t.length?(n=n.filter((e=>!t.includes(e))),this.T.set(e,t)):this.T.delete(e),o=!0)}else this.T.delete(e),o=!0;const r=t.t.querySelectorAll(e);t.O(r,n)}return o}render(){let e=!0;clearTimeout(this.R),this.R=void 0;const s=t.t.querySelector(this.v);if(null!=s){const e=this._(this.N);if(e!==this.M){this.M=e,this.k.innerHTML=e;for(const[e,s]of this.T){const i=t.t.querySelectorAll(e);t.O(i,s)}this.D?this.j.render.pre.forEach((t=>t(this.N,this.S))):this.j.init.pre.forEach((t=>t(this.N))),t.L(this.k.content,s,{content:!1,style:!1}),s.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{e.name.startsWith("data-myopie-")&&t.removeAttribute(e.name)})))),this.D?this.j.render.post.forEach((t=>t(this.N,this.S))):(this.j.init.post.forEach((t=>t(this.N))),this.D=!0);for(const[e,s]of this.T){const i=t.t.querySelectorAll(e);if(i.length&&s.length)for(const t of i)for(const{event:e,listener:i}of s)t.addEventListener(e,i)}}this.S=void 0}else e=!1;return e}get(e){let s;if(null!=e){const i=e.split(t.l);0<i.length&&(s=i.reduce(((e,s)=>{if(void 0!==e){const i=t.i.call(e).slice(8,-1);e=(t.p[i]?t.p[i](e,s,!1):[!1,void 0])[1]}return e}),this.N))}return"function"==typeof s&&(s=s()),s}set(e,s,i=!0){let o=!1,n=!1;this.S||(n=!0,this.S=t.I(this.N));let r=!1;const c=e.split(t.l),a=c.length-1,h=c.slice(0,a).reduce(((e,s)=>{if(void 0!==e){const i=t.i.call(e).slice(8,-1);let o;[o,e]=t.p[i]?t.p[i](e,s,!0):[!1,void 0],r||=o}return e}),this.N);if(void 0!==h){o=!0;const t=c[a];h[t]!==s&&(r=!0,void 0!==s?h[t]=s:delete h[t]),r?i&&this.renderDebounce():n&&(this.S=void 0)}return o}}