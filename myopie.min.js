"use strict";export default class t{static t=Node.ELEMENT_NODE;static i=Node.TEXT_NODE;static o=Object.prototype.toString;h;l;u;p;m;v;_;k=new Map;A={};T=null;P=!1;j;R;D={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,s,i,o={},n=[],r=100,h=!0){this.h=e,this.u=s,this.p=i,this.v=r,this.l=n,this.A=t.I(o),this.m=e.createElement("template");const l={input:t=>{const e=t;return"checkbox"===e.type||"radio"===e.type?e.checked:e.value},select:t=>t.value,textarea:t=>t.value};this._=t=>{const e=t?.target;if(e instanceof HTMLElement){const t=e.tagName.toLowerCase(),s=l[t];s&&this.l.some((([t,i])=>{let o=!1;return e.matches(t)&&(o=!0,this.set(i,s(e),h)),o}))}},this.h.addEventListener("input",this._)}static I(e){let s;const i=typeof e;switch("object"===i?t.o.call(e).slice(8,-1):i){case"Array":case"Object":s=Array.isArray(e)?[]:{};for(const i in e){const o=e[i];s[i]=t.I(o)}break;case"Date":s=new Date(e.getTime());break;case"RegExp":s=RegExp(e.source,e.flags);break;default:s=e}return s}static C(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(!!t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}static M(e,s,i){const o=e.childNodes,n=s.childNodes,r=o.length;for(let e=0;e<r;e++){const r=o[e];if(n.length<=e)switch(r.nodeType){case t.t:s.append(r.cloneNode(!0));break;case t.i:s.append(r.nodeValue)}else{let o=n[e];if(!o.isEqualNode(r)){const h=t.C(r,o),l=h?void 0:Array.from(n).slice(e+1).find((e=>t.t===e.nodeType&&t.C(r,e)));if(h||(o=s.insertBefore(l??r.cloneNode(!0),e<n.length?o:null)),h||l){const e=r.childNodes.length?null:r.textContent;if(e!=(o.childNodes.length?null:o.textContent)&&(o.textContent=e),t.t===r.nodeType){const e=r.attributes,s=o.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(i.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(i.style=!0);let n=[];for(let{name:t,value:r}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===s.getNamedItem(e)&&(n.push(e),o.setAttribute(e,r))}else t.startsWith("data-myopie-")||(i?.style&&"style"==t||["input","option","textarea"].includes(o.tagName)&&["value","selected","checked"].includes(t))&&null!==s.getNamedItem(t)||o.setAttribute(t,r);for(let{name:t}of s)null!==e.getNamedItem(t)||n.includes(t)||i?.style&&"style"===t||o.removeAttribute(t);i.content||(!r.childNodes.length&&o.childNodes.length?o.innerHTML="":t.M(r,o,{...i}))}}}}}for(let t=n.length-1;t>=r;t--)n[t].remove()}destroy(){void 0!==this.R&&(clearTimeout(this.R),this.R=void 0),this.h.removeEventListener("input",this._);for(const[t,e]of this.k){const s=this.h.querySelectorAll(t);if(s.length&&e.length)for(const t of s)for(const{event:s,listener:i}of e)t.removeEventListener(s,i)}}hooksInitAddPre(t){this.D.init.pre.push(t)}hooksInitAddPost(t){this.D.init.post.push(t)}hooksRenderAddPre(t){this.D.render.pre.push(t)}hooksRenderAddPost(t){this.D.render.post.push(t)}handlersPermanentAdd(t,e,s){const i=this.k.get(t)??[];let o=!i.some((t=>e===t.event&&s===t.listener));return o&&this.k.set(t,[...i,{event:e,listener:s}]),o}handlersPermanentDel(t,e,s){let i=!1;if(this.k.has(t)){let o=this.k.get(t)??[];if(e){const n=o.filter((t=>!(t.event===e&&(!s||s===t.listener))));n.length<o.length&&(n.length?(o=o.filter((t=>!n.includes(t))),this.k.set(t,n)):this.k.delete(t),i=!0)}else this.k.delete(t),i=!0;o.forEach((({event:e,listener:s})=>{this.h.querySelectorAll(t).forEach((t=>t.removeEventListener(e,s)))}))}return i}render(){let e=!0;clearTimeout(this.R),this.R=void 0;const s=this.h.querySelector(this.u);if(null!=s){const e=this.p(this.A);if(e!==this.j){this.j=e,this.m.innerHTML=e;for(const[t,e]of this.k){const s=this.h.querySelectorAll(t);if(s.length&&e.length)for(const t of s)for(const{event:s,listener:i}of e)t.removeEventListener(s,i)}this.P?this.D.render.pre.forEach((t=>t(this.A,this.T))):this.D.init.pre.forEach((t=>t(this.A))),t.M(this.m.content,s,{content:!1,style:!1}),s.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{e.name.startsWith("data-myopie-")&&t.removeAttribute(e.name)})))),this.P?this.D.render.post.forEach((t=>t(this.A,this.T))):(this.D.init.post.forEach((t=>t(this.A))),this.P=!0);for(const[t,e]of this.k){const s=this.h.querySelectorAll(t);if(s.length&&e.length)for(const t of s)for(const{event:s,listener:i}of e)t.addEventListener(s,i)}}this.T=null}else e=!1;return e}get(t){let e;if(null!=t){const s=t.split(/(?<!(?<!\\)\\)\//),i=s.length;if(0<i){e=this.A;for(let t=0;t<i&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const i=s[t];e=void 0!==e[i]?e[i]:void 0}else e=void 0}}return"function"==typeof e&&(e=e()),e}set(e,s,i=!0){let o=!1;null===this.T&&(o=!0,this.T=t.I(this.A));let n=this.A,r=!1;const h=e.split(/(?<!(?<!\\)\\)\//),l=h.length-1;for(let t=0;t<l;t++){let e=h[t];void 0===n[e]&&(r=!0,n[e]={}),n=n[e]}const c=h[l];n[c]!==s&&(void 0!==s?(r=!0,n[c]=s):void 0!==n[c]&&(r=!0,delete n[c])),r?i&&(this.v>0?(void 0!==this.R&&clearTimeout(this.R),this.R=setTimeout((()=>this.render()),this.v)):this.render()):o&&(this.T=null)}}