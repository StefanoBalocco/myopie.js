"use strict";class myopie{constructor(t,e,i={},s=[],o){this.timeout=0,this.timer=void 0,this.dataCurrent={},this.dataPrevious=null,this.inited=!1,this.hooks={init:{pre:[],post:[]},render:{pre:[],post:[]}},this.selector=t,this.template=e,this.timeout=o,this.inputToPath=s,this.dataCurrent=myopie.DeepClone(i),document.addEventListener("input",(t=>{const e=t,i=this.inputToPath.length;for(let t=0;t<i;t++)if(e&&e.target&&e.target.matches(this.inputToPath[t][0]))switch(e.target.type){case"checkbox":case"radio":this.set(this.inputToPath[t][1],e.target.checked,!1);break;default:this.set(this.inputToPath[t][1],e.target.value,!1)}}))}static Create(t,e,i={},s=[],o=1e3){return new myopie(t,e,i,s,o)}static DeepClone(t){let e=null;switch(typeof t){case"undefined":case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":e=t;break;case"object":if(null===t)e=null;else{e=Array.isArray(t)?[]:{};for(let i in t){let s=t[i],o={}.toString.call(s).slice(8,-1);if("Array"==o||"Object"==o)e[i]=myopie.DeepClone(s);else if("Date"==o)e[i]=new Date(s.getTime());else if("RegExp"==o){let t="";if("string"==typeof s.source.flags)t=s.source.flags;else{let e=[];s.global&&e.push("g"),s.ignoreCase&&e.push("i"),s.multiline&&e.push("m"),s.sticky&&e.push("y"),s.unicode&&e.push("u"),t=e.join("")}e[i]=RegExp(s.source,t)}else e[i]=s}}}return e}static SimilarNode(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}DiffNode(t,e,i){var s,o;const l=t.childNodes,n=e.childNodes;for(let t=0;t<l.length;t++){const h=l[t];let r;if(n.length<=t)r=e.appendChild(h.cloneNode(!0));else{r=n[t];let c=!1;if(!r.isEqualNode(h)){if(!myopie.SimilarNode(h,r)){let i=Array.from(n).slice(t+1).find((t=>myopie.SimilarNode(h,t)));i?r=e.insertBefore(i.cloneNode(!0),t<n.length?r:null):(r=e.insertBefore(h.cloneNode(!0),t<n.length?r:null),c=!0)}if(!c){const t=h.childNodes&&h.childNodes.length?null:h.textContent;if(t!=(r.childNodes&&r.childNodes.length?null:r.textContent)&&(r.textContent=t),1===h.nodeType){i||(i={content:!1,style:!1});const t=h.attributes,e=r.attributes;"true"===(null===(s=t.getNamedItem("data-myopie-ignore-content"))||void 0===s?void 0:s.value)&&(i.content=!0),"true"===(null===(o=t.getNamedItem("data-myopie-ignore-style"))||void 0===o?void 0:o.value)&&(i.style=!0);for(let{name:s,value:o}of t)if(s.startsWith("data-myopie-default-")&&20<s.length){const t=s.substr(20);null===e.getNamedItem(t)&&r.setAttribute(t,o)}else((null==i?void 0:i.style)&&"style"==s||-1!==["input","option","textarea"].indexOf(r.tagName)&&-1!==["value","selected","checked"].indexOf(s))&&null!==e.getNamedItem(s)||r.setAttribute(s,o);for(let{name:s}of e)null===t.getNamedItem(s)&&((null==i?void 0:i.style)&&"style"===s||r.removeAttribute(s));if(!i.content){!h.childNodes.length&&r.childNodes.length?r.innerHTML="":(!r.childNodes.length&&h.childNodes.length,this.DiffNode(h,r,i));for(let t=n.length-l.length;t>0;t--)n[n.length-1].remove()}}}}}}}HooksInitAddPre(t){this.hooks.init.pre.push(t)}HooksInitAddPost(t){this.hooks.init.post.push(t)}HooksRenderAddPre(t){this.hooks.render.pre.push(t)}HooksRenderAddPost(t){this.hooks.render.post.push(t)}render(){this.timer=void 0;const t=document.querySelector(this.selector);if(null!=t){if(this.inited){const t=this.hooks.render.pre.length;for(let e=0;e<t;e++)this.hooks.render.pre[e](this.dataCurrent,this.dataPrevious)}else{const t=this.hooks.init.pre.length;for(let e=0;e<t;e++)this.hooks.init.pre[e](this.dataCurrent)}let e=(new DOMParser).parseFromString(this.template(this.dataCurrent),"text/html");e.head&&e.head.childNodes&&e.head.childNodes.length&&Array.from(e.head.childNodes).reverse().forEach((function(t){e.body.insertBefore(t,e.body.firstChild)}));const i=e&&e.body?e.body:document.createElement("body");if(this.DiffNode(i,t),this.inited){const t=this.hooks.render.post.length;for(let e=0;e<t;e++)this.hooks.render.post[e](this.dataCurrent,this.dataPrevious)}else{const t=this.hooks.init.post.length;for(let e=0;e<t;e++)this.hooks.init.post[e](this.dataCurrent);this.inited=!0}this.dataPrevious=null}}get(t){let e=this.dataCurrent;if(null!=t){let i=t.split(/(?<!(?<!\\)\\)\//);const s=i.length;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}return e}set(t,e,i=!0){null===this.dataPrevious&&(this.dataPrevious=myopie.DeepClone(this.dataCurrent));let s=this.dataCurrent,o=t.split(/(?<!(?<!\\)\\)\//);const l=o.length;for(let t=0;t<l-1;t++){let e=o[t];void 0===s[e]&&(s[e]={}),s=s[e]}s[o[l-1]]=e,i&&(this.timeout>0?(void 0!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>this.render()),this.timeout)):this.render())}}