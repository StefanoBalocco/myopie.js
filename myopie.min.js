"use strict";export default class t{static t=Object.prototype.toString;i;o;l=0;h;u;p;m=void 0;v={};_=null;k=!1;A={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,i,s,o={},n=[],l=100,r=!0){this.u=e,this.i=i,this.o=s,this.l=l,this.h=n,this.v=t.P(o),this.p=t=>{const e=t?.target;e instanceof HTMLInputElement&&this.h.some((([t,i])=>{let s=!1;if(e.matches(t)){switch(e.type){case"checkbox":case"radio":this.set(i,e.checked,r);break;default:this.set(i,e.value,r)}s=!0}return s}))},this.u.addEventListener("input",this.p)}static P(e){let i;const s=typeof e;switch("object"===s?t.t.call(e).slice(8,-1):s){case"Array":case"Object":i=Array.isArray(e)?[]:{};for(const s in e){const o=e[s];i[s]=t.P(o)}break;case"Date":i=new Date(e.getTime());break;case"RegExp":i=RegExp(e.source,e.flags);break;default:i=e}return i}static T(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(!!t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}static j(e,i,s){const o=e.childNodes,n=i.childNodes,l=o.length;for(let e=0;e<l;e++){const l=o[e];if(n.length<=e)switch(l.nodeType){case 1:i.append(l.cloneNode(!0));break;case 3:i.append(l.nodeValue)}else{let o=n[e],r=!1;if(!o.isEqualNode(l)){if(!t.T(l,o)){let s=Array.from(n).slice(e+1).find((e=>t.T(l,e)));s?o=i.insertBefore(s,e<n.length?o:null):(o=i.insertBefore(l.cloneNode(!0),e<n.length?o:null),r=!0)}if(!r){const e=l.childNodes&&l.childNodes.length?null:l.textContent;if(e!=(o.childNodes&&o.childNodes.length?null:o.textContent)&&(o.textContent=e),1===l.nodeType){const e=l.attributes,i=o.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(s.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(s.style=!0);let n=[];for(let{name:t,value:l}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===i.getNamedItem(e)&&(n.push(e),o.setAttribute(e,l))}else t.startsWith("data-myopie-")||(s?.style&&"style"==t||["input","option","textarea"].includes(o.tagName)&&["value","selected","checked"].includes(t))&&null!==i.getNamedItem(t)||o.setAttribute(t,l);for(let{name:t}of i)null!==e.getNamedItem(t)||n.includes(t)||s?.style&&"style"===t||o.removeAttribute(t);s.content||(!l.childNodes.length&&o.childNodes.length?o.innerHTML="":(!o.childNodes.length&&l.childNodes.length,t.j(l,o,Object.assign({},s))))}}}}}for(let t=n.length-1;t>=l;t--)n[t].remove()}destroy(){this.u.removeEventListener("input",this.p),void 0!==this.m&&(clearTimeout(this.m),this.m=void 0)}HooksInitAddPre(t){this.A.init.pre.push(t)}HooksInitAddPost(t){this.A.init.post.push(t)}HooksRenderAddPre(t){this.A.render.pre.push(t)}HooksRenderAddPost(t){this.A.render.post.push(t)}render(){clearTimeout(this.m),this.m=void 0;const e=this.u.querySelector(this.i);if(null!=e){this.k?this.A.render.pre.forEach((t=>t(this.v,this._))):this.A.init.pre.forEach((t=>t(this.v)));const i=(new DOMParser).parseFromString(this.o(this.v),"text/html");i.head&&i.head.childNodes&&i.head.childNodes.length&&Array.from(i.head.childNodes).reverse().forEach((function(t){i.body.insertBefore(t,i.body.firstChild)}));const s=i&&i.body?i.body:this.u.createElement("body");t.j(s,e,{content:!1,style:!1}),e.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{e.name.startsWith("data-myopie-")&&t.removeAttribute(e.name)})))),this.k?this.A.render.post.forEach((t=>t(this.v,this._))):(this.A.init.post.forEach((t=>t(this.v))),this.k=!0),this._=null}}get(t){let e;if(null!=t){const i=t.split(/(?<!(?<!\\)\\)\//),s=i.length;if(0<s){e=this.v;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}}return"function"==typeof e&&(e=e()),e}set(e,i,s=!0){let o=!1;null===this._&&(o=!0,this._=t.P(this.v));let n=this.v,l=!1;const r=e.split(/(?<!(?<!\\)\\)\//),h=r.length-1;for(let t=0;t<h;t++){let e=r[t];void 0===n[e]&&(l=!0,n[e]={}),n=n[e]}const a=r[h];n[a]!==i&&(void 0!==i?(l=!0,n[a]=i):void 0!==n[a]&&(l=!0,delete n[a])),l?s&&(this.l>0?(void 0!==this.m&&clearTimeout(this.m),this.m=setTimeout((()=>this.render()),this.l)):this.render()):o&&(this._=null)}}