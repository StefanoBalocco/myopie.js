"use strict";export default class t{t;i;o=0;l;h=void 0;u={};p=null;m=!1;v={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,i,s={},o=[],l=100,n=!0){this.t=e,this.i=i,this.o=l,this.l=o,this.u=t._(s),document.addEventListener("input",(t=>{const e=t;const i=this.l.length;for(let t=0;t<i;t++)if(e&&e.target&&e.target.matches(this.l[t][0]))switch(e.target.type){case"checkbox":case"radio":this.set(this.l[t][1],e.target.checked,n);break;default:this.set(this.l[t][1],e.target.value,n)}}))}static _(e){let i=null;switch(typeof e){case"undefined":case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":i=e;break;case"object":if(null===e)i=null;else{i=Array.isArray(e)?[]:{};for(let s in e){let o=e[s],l={}.toString.call(o).slice(8,-1);if("Array"==l||"Object"==l)i[s]=t._(o);else if("Date"==l)i[s]=new Date(o.getTime());else if("RegExp"==l){let t="";if("string"==typeof o.source.flags)t=o.source.flags;else{let e=[];o.global&&e.push("g"),o.ignoreCase&&e.push("i"),o.multiline&&e.push("m"),o.sticky&&e.push("y"),o.unicode&&e.push("u"),t=e.join("")}i[s]=RegExp(o.source,t)}else i[s]=o}}}return i}static k(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(!!t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}static A(e,i,s){const o=e.childNodes,l=i.childNodes,n=o.length;for(let e=0;e<n;e++){const n=o[e];let r;if(l.length<=e)switch(n.nodeType){case 1:i.append(n.cloneNode(!0));break;case 3:i.append(n.nodeValue)}else{r=l[e];let o=!1;if(!r.isEqualNode(n)){if(!t.k(n,r)){let s=Array.from(l).slice(e+1).find((e=>t.k(n,e)));s?r=i.insertBefore(s,e<l.length?r:null):(r=i.insertBefore(n.cloneNode(!0),e<l.length?r:null),o=!0)}if(!o){const e=n.childNodes&&n.childNodes.length?null:n.textContent;if(e!=(r.childNodes&&r.childNodes.length?null:r.textContent)&&(r.textContent=e),1===n.nodeType){const e=n.attributes,i=r.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(s.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(s.style=!0);let o=[];for(let{name:t,value:l}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===i.getNamedItem(e)&&(o.push(e),r.setAttribute(e,l))}else t.startsWith("data-myopie-")||(s?.style&&"style"==t||["input","option","textarea"].includes(r.tagName)&&["value","selected","checked"].includes(t))&&null!==i.getNamedItem(t)||r.setAttribute(t,l);for(let{name:t}of i)null!==e.getNamedItem(t)||o.includes(t)||s?.style&&"style"===t||r.removeAttribute(t);s.content||(!n.childNodes.length&&r.childNodes.length?r.innerHTML="":(!r.childNodes.length&&n.childNodes.length,t.A(n,r,Object.assign({},s))))}}}}}for(let t=l.length-o.length;t>0;t--)l[l.length-1].remove()}HooksInitAddPre(t){this.v.init.pre.push(t)}HooksInitAddPost(t){this.v.init.post.push(t)}HooksRenderAddPre(t){this.v.render.pre.push(t)}HooksRenderAddPost(t){this.v.render.post.push(t)}render(){this.h=void 0;const e=document.querySelector(this.t);if(null!=e){if(this.m)for(let t=0,e=this.v.render.pre.length;t<e;t++)this.v.render.pre[t](this.u,this.p);else for(let t=0,e=this.v.init.pre.length;t<e;t++)this.v.init.pre[t](this.u);let i=(new DOMParser).parseFromString(this.i(this.u),"text/html");i.head&&i.head.childNodes&&i.head.childNodes.length&&Array.from(i.head.childNodes).reverse().forEach((function(t){i.body.insertBefore(t,i.body.firstChild)}));const s=i&&i.body?i.body:document.createElement("body");t.A(s,e,{content:!1,style:!1});const o=e.querySelectorAll("*");for(let t=0,e=o.length;t<e;t++)for(let e=0,i=o[t].attributes?.length;e<i;e++)o[t].attributes[e].name.startsWith("data-myopie-")&&(o[t].removeAttribute(o[t].attributes[e].name),e--,i--);if(this.m)for(let t=0,e=this.v.render.post.length;t<e;t++)this.v.render.post[t](this.u,this.p);else{for(let t=0,e=this.v.init.post.length;t<e;t++)this.v.init.post[t](this.u);this.m=!0}this.p=null}}get(t){let e;if(null!=t){let i=t.split(/(?<!(?<!\\)\\)\//);const s=i.length;if(0<s){e=this.u;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}}return"function"==typeof e&&(e=e()),e}set(e,i,s=!0){let o=!1;null===this.p&&(o=!0,this.p=t._(this.u));let l=this.u,n=e.split(/(?<!(?<!\\)\\)\//),r=!1;const h=n.length;for(let t=0;t<h-1;t++){let e=n[t];void 0===l[e]&&(r=!0,l[e]={}),l=l[e]}const a=n[h-1];l[a]!==i&&(void 0!==i?(r=!0,l[a]=i):void 0!==l[a]&&(r=!0,delete l[a])),r?s&&(this.o>0?(void 0!==this.h&&clearTimeout(this.h),this.h=setTimeout((()=>this.render()),this.o)):this.render()):o&&(this.p=null)}}