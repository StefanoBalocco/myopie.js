"use strict";export default class t{static t=Object.prototype.toString;i;o;h=0;l;u;p;m=void 0;v={};_=null;k=!1;A={init:{pre:[],post:[]},render:{pre:[],post:[]}};constructor(e,i,s,o={},n=[],r=100,h=!0){this.u=e,this.i=i,this.o=s,this.h=r,this.l=n,this.v=t.P(o),this.p=t=>{const e=t?.target;e instanceof HTMLInputElement&&this.l.some((([t,i])=>{let s=!1;if(e.matches(t)){switch(e.type){case"checkbox":case"radio":this.set(i,e.checked,h);break;default:this.set(i,e.value,h)}s=!0}return s}))},this.u.addEventListener("input",this.p)}static P(e){let i;const s=typeof e;switch("object"===s?t.t.call(e).slice(8,-1):s){case"Array":case"Object":i=Array.isArray(e)?[]:{};for(const s in e){const o=e[s];i[s]=t.P(o)}break;case"Date":i=new Date(e.getTime());break;case"RegExp":i=RegExp(e.source,e.flags);break;default:i=e}return i}static T(t,e){return t.nodeType===e.nodeType&&t.tagName===e.tagName&&t.id===e.id&&(!!t.id||t.src&&t.src===e.src||t.href&&t.href===e.href||t.className===e.className||t.childElementCount===e.childElementCount||!t.src&&!e.src&&!t.href&&!e.href&&!t.className&&!e.className)}static j(e,i,s){const o=e.childNodes,n=i.childNodes,r=o.length;for(let e=0;e<r;e++){const r=o[e];if(n.length<=e)switch(r.nodeType){case Node.ELEMENT_NODE:i.append(r.cloneNode(!0));break;case Node.TEXT_NODE:i.append(r.nodeValue)}else{let o=n[e];if(!o.isEqualNode(r)){const h=t.T(r,o),l=h?void 0:Array.from(n).slice(e+1).find((e=>t.T(r,e)));if(h||(o=i.insertBefore(l??r.cloneNode(!0),e<n.length?o:null)),h||l){const e=r.childNodes?.length?null:r.textContent;if(e!=(o.childNodes?.length?null:o.textContent)&&(o.textContent=e),Node.ELEMENT_NODE===r.nodeType){const e=r.attributes,i=o.attributes;"true"===e.getNamedItem("data-myopie-ignore-content")?.value&&(s.content=!0),"true"===e.getNamedItem("data-myopie-ignore-style")?.value&&(s.style=!0);let n=[];for(let{name:t,value:r}of e)if(t.startsWith("data-myopie-default-")&&20<t.length){const e=t.substring(20);null===i.getNamedItem(e)&&(n.push(e),o.setAttribute(e,r))}else t.startsWith("data-myopie-")||(s?.style&&"style"==t||["input","option","textarea"].includes(o.tagName)&&["value","selected","checked"].includes(t))&&null!==i.getNamedItem(t)||o.setAttribute(t,r);for(let{name:t}of i)null!==e.getNamedItem(t)||n.includes(t)||s?.style&&"style"===t||o.removeAttribute(t);s.content||(!r.childNodes.length&&o.childNodes.length?o.innerHTML="":t.j(r,o,{...s}))}}}}}for(let t=n.length-1;t>=r;t--)n[t].remove()}destroy(){this.u.removeEventListener("input",this.p),void 0!==this.m&&(clearTimeout(this.m),this.m=void 0)}HooksInitAddPre(t){this.A.init.pre.push(t)}HooksInitAddPost(t){this.A.init.post.push(t)}HooksRenderAddPre(t){this.A.render.pre.push(t)}HooksRenderAddPost(t){this.A.render.post.push(t)}render(){clearTimeout(this.m),this.m=void 0;const e=this.u.querySelector(this.i);if(null!=e){this.k?this.A.render.pre.forEach((t=>t(this.v,this._))):this.A.init.pre.forEach((t=>t(this.v)));const i=(new DOMParser).parseFromString(this.o(this.v),"text/html");i.head&&i.head.childNodes&&i.head.childNodes.length&&Array.from(i.head.childNodes).reverse().forEach((function(t){i.body.insertBefore(t,i.body.firstChild)}));const s=i&&i.body?i.body:this.u.createElement("body");t.j(s,e,{content:!1,style:!1}),e.querySelectorAll("*").forEach((t=>Array.from(t.attributes).forEach((e=>{e.name.startsWith("data-myopie-")&&t.removeAttribute(e.name)})))),this.k?this.A.render.post.forEach((t=>t(this.v,this._))):(this.A.init.post.forEach((t=>t(this.v))),this.k=!0),this._=null}}get(t){let e;if(null!=t){const i=t.split(/(?<!(?<!\\)\\)\//),s=i.length;if(0<s){e=this.v;for(let t=0;t<s&&void 0!==e;t++)if(Array.isArray(e)||"object"==typeof e){const s=i[t];e=void 0!==e[s]?e[s]:void 0}else e=void 0}}return"function"==typeof e&&(e=e()),e}set(e,i,s=!0){let o=!1;null===this._&&(o=!0,this._=t.P(this.v));let n=this.v,r=!1;const h=e.split(/(?<!(?<!\\)\\)\//),l=h.length-1;for(let t=0;t<l;t++){let e=h[t];void 0===n[e]&&(r=!0,n[e]={}),n=n[e]}const a=h[l];n[a]!==i&&(void 0!==i?(r=!0,n[a]=i):void 0!==n[a]&&(r=!0,delete n[a])),r?s&&(this.h>0?(void 0!==this.m&&clearTimeout(this.m),this.m=setTimeout((()=>this.render()),this.h)):this.render()):o&&(this._=null)}}